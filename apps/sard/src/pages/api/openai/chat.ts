import { NextApiRequest, NextApiResponse } from "next";
import {
  ParsedEvent,
  ReconnectInterval,
  createParser,
} from "eventsource-parser";
import cors from "@profits-gg/lib/cors";
import { ipRateLimit } from "@profits-gg/lib/ip-rate-limit";
import { prisma } from "~/server/db";

export const config = {
  runtime: "edge",
};

const verifyRecaptcha = async (token: string) => {
  const secretKey = process.env.RECAPTCHA_V3_SECRET_KEY;

  const response = await fetch(
    `https://www.google.com/recaptcha/api/siteverify?secret=${secretKey}&response=${token}`,
    {
      method: "POST",
    }
  );

  return await response.json();
};

export default async function handler(req: Request) {
  const { category, place, userId, token } = (await req.json()) as {
    category: string;
    token: string;
    place: string;
    userId: string;
  };

  const recaptchaResponse = await verifyRecaptcha(token);

  let res;

  if (userId) {
    res = await ipRateLimit(
      req,
      userId,
      1,
      60 // 1 minute
    );
  } else {
    res = await ipRateLimit(req);
  }

  if (res.status !== 200) return res;

  if (!recaptchaResponse.success) {
    return new Response("Recaptcha failed", { status: 400 });
  }

  if (
    process.env.NODE_ENV === "production" &&
    recaptchaResponse.hostname !==
      new URL(String(process.env.NEXTAUTH_URL)).hostname
  ) {
    return new Response("Recaptcha hostname mismatch", { status: 400 });
  }

  if (recaptchaResponse.score < 0.5) {
    return new Response("Recaptcha score too low", { status: 400 });
  }

  if (!category) {
    return new Response("Category is required", { status: 400 });
  }

  const encoder = new TextEncoder();
  const decoder = new TextDecoder();

  let counter = 0;

  const response = await fetch("https://api.openai.com/v1/chat/completions", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      Authorization: `Bearer ${process.env.OPENAI_API_KEY}`,
    },
    body: JSON.stringify({
      model: "gpt-3.5-turbo-16k",
      stream: true,
      temperature: 1,
      top_p: 1,
      max_tokens: 1100,
      messages: [
        {
          role: "system",
          content: `
          act as a storyteller for children

          - you should return a title, description, url slug, image prompt for open ai dalle model and the content of the story
          - story should be around a character and be fantastical, with set up, with plot twist, with rising action, with monomyth,  with False start , with Converging ideas , with Sparklines , with dramatic climax, with falling actions, end with resolution
          - the description should be short and contain the main story parts
          - the character can be a person name, an animal, an inanimate
          - use arabic for the title, slug and the content without translation
          - the content length should be between 200 -  350 word and after every 5 words use a proper emoji 
          - image prompt should use description with min 10 words and should be in english
          - use simple language
          `,
        },
        {
          role: "user",
          content: `story for childrens and is about bravery`,
        },
        {
          role: "assistant",
          content: `
          Ù‚ØµØ© Ø¹Ù† Ø§Ù„Ø´Ø¬Ø§Ø¹Ø©
          #
          Ø§Ù„ÙØªØ§Ø© Ùˆ Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ù…Ø¬Ù‡ÙˆÙ„
          #
          ÙØªØ§Ø© Ø´Ø§Ø¨Ø© Ø´Ø¬Ø§Ø¹Ø© ØªØ¶Ø±Ø¨ ÙÙŠ Ø§Ù„Ù…Ø¬Ù‡ÙˆÙ„ ÙˆØªØ¬Ø¯ Ø§Ù„Ø³Ø¹Ø§Ø¯Ø© ÙˆØ§Ù„Ø«Ù‚Ø© ÙÙŠ Ù†ÙØ³Ù‡Ø§
          #
          Ø§Ù„ÙØªØ§Ø©-ÙˆØ§Ù„Ø¨Ø­Ø±-Ø§Ù„Ù…Ø¬Ù‡ÙˆÙ„
          #
          a silhouette of a girl on a cliff with a view of the sea
          #
          ÙƒØ§Ù†Øª ÙØ§Ø·Ù…Ø© ØªØ¹ÙŠØ´ ÙÙŠ Ù‚Ø±ÙŠØ© ØµØºÙŠØ±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø·Ø¦ ðŸ–ï¸. ÙƒØ§Ù†Øª Ø§Ù„Ù‚Ø±ÙŠØ© Ø­ÙŠÙˆÙŠØ© ÙˆÙ…Ù„ÙŠØ¦Ø© Ø¨Ø§Ù„Ù…ØºØ§Ù…Ø±Ø§ØªØŒ ÙˆÙ„ÙƒÙ† ÙØ§Ø·Ù…Ø© Ø£Ø±Ø§Ø¯Øª Ø§Ù„Ù…Ø²ÙŠØ¯! ðŸŒŸ

          ÙƒØ§Ù†Øª ÙØ§Ø·Ù…Ø© Ø¬Ø±ÙŠØ¦Ø© ÙˆØ·Ù…ÙˆØ­Ø© ðŸ˜Š. Ø£Ø±Ø§Ø¯Øª Ø§Ø³ØªÙƒØ´Ø§Ù Ø§Ù„Ø¹Ø§Ù„Ù… ÙˆØªØ­Ù‚ÙŠÙ‚ Ø£Ø­Ù„Ø§Ù…Ù‡Ø§ Ø§Ù„ÙƒØ¨ÙŠØ±Ø©. Ù„ÙƒÙ†Ù‡Ø§ ÙƒØ§Ù†Øª Ù‚Ù„Ù‚Ø© ÙˆÙ…ØªØ±Ø¯Ø¯Ø©. ðŸ˜°

          Ù„ÙƒÙ†Ù‡Ø§ Ù‚Ø±Ø±Øª Ø£Ø®ÙŠØ±Ù‹Ø§ Ø§Ù„Ù…ØºØ§Ø¯Ø±Ø©! â›µï¸ ÙˆØ§Ø¬Ù‡Øª ØªØ­Ø¯ÙŠØ§Øª ÙƒØ«ÙŠØ±Ø© ÙˆØªØ¹Ù„Ù…Øª Ø§Ù„ÙƒØ«ÙŠØ±. ðŸŒ

          ÙÙŠ Ø¥Ø­Ø¯Ù‰ Ø§Ù„Ø£ÙŠØ§Ù…ØŒ ØªØ¹Ø±Ø¶Øª ÙØ§Ø·Ù…Ø© Ù„Ø¥Ø¹ØµØ§Ø± Ù…Ø±Ø¹Ø¨! ðŸŒªï¸ ÙˆÙ„ÙƒÙ†Ù‡Ø§ Ù„Ù… ØªØ³ØªØ³Ù„Ù…. Ø§Ø³ØªØ®Ø¯Ù…Øª Ù‚ÙˆØªÙ‡Ø§ Ø§Ù„Ø®Ø§Ø±Ù‚Ø© ÙˆØªØºÙ„Ø¨Øª Ø¹Ù„ÙŠÙ‡! ðŸ’ª

          Ø£ØµØ¨Ø­Øª ÙØ§Ø·Ù…Ø© Ø¨Ø·Ù„Ø© Ø§Ù„Ø¨Ø­Ø§Ø± ðŸŒŸðŸŒŠ. Ø¹Ø§Ø¯Øª Ù„Ù„Ù‚Ø±ÙŠØ© Ù…Ø­Ù…Ù„Ø© Ø¨Ø§Ù„Ù…ØºØ§Ù…Ø±Ø§Øª ÙˆØ£ØµØ¨Ø­Øª Ø±Ù…Ø²Ù‹Ø§ Ù„Ù„Ø´Ø¬Ø§Ø¹Ø© ÙˆØ§Ù„Ù‚ÙˆØ© ðŸ’–.

          ÙØ§Ø·Ù…Ø© Ø£Ø¯Ø±ÙƒØª Ù‚ÙˆØªÙ‡Ø§ ÙˆØªØµÙ…ÙŠÙ…Ù‡Ø§ Ø§Ù„Ù‚ÙˆÙŠ. ÙˆÙ‚Ø§Ù„Øª: "Ø£Ø³ØªØ·ÙŠØ¹ ØªØ­Ù‚ÙŠÙ‚ Ø£ÙŠ Ø­Ù„Ù…!" âœ¨`,
        },
        {
          role: "user",
          content: `story for childrens and is about cooperation`,
        },
        {
          role: "assistant",
          content: `
          Ù‚ØµØ© Ø¹Ù† Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
          #
          Ø§Ù„Ø±Ø¬Ù„ Ø§Ù„Ø¹Ø¬ÙˆØ² Ùˆ Ø§Ù„Ø£ÙˆØ±Ø§Ù‚ Ø§Ù„Ù…ØªÙ†Ø§Ø«Ø±Ø©
          #
          ÙØ£Ø± ÙŠØ³Ø§Ø¹Ø¯ Ø±Ø¬Ù„ Ø¹Ø¬ÙˆØ² ÙÙŠ Ù…Ù‡Ù…ØªÙ‡
          #
          Ø§Ù„Ø±Ø¬Ù„-Ø§Ù„Ø¹Ø¬ÙˆØ²-Ùˆ-Ø§Ù„Ø£ÙˆØ±Ø§Ù‚-Ø§Ù„Ù…ØªÙ†Ø§Ø«Ø±Ø©
          #
          old wooden desk with papers and a mouse on it
          #
          Ø¬Ù„Ø³ Ø§Ù„Ø¹Ø¬ÙˆØ² ÙÙŠ ØºØ±ÙØªÙ‡ ðŸ  ÙˆØ¹Ø¬ Ø¨Ø§Ù„ÙˆØ±Ù‚ ÙˆØ§Ù„Ø£ÙˆØ±Ø§Ù‚ Ø§Ù„Ù…ØªÙ†Ø§Ø«Ø±Ø©. ÙƒØ§Ù† ÙŠØ­ØªØ§Ø¬ Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©! ðŸ¤”

          ÙØ¬Ø£Ø©ØŒ Ø±Ø£Ù‰ ÙØ£Ø±Ù‹Ø§ ØµØºÙŠØ±Ù‹Ø§ ðŸ­ ÙŠØªØ³Ù„Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ø«Ø§Ø«. ÙÙƒØ± ÙÙŠ ÙÙƒØ±Ø© Ù…Ø¬Ù†ÙˆÙ†Ø©! ðŸ¤ª

          "Ù…Ù…ÙƒÙ† ØªØ³Ø§Ø¹Ø¯Ù†ÙŠØŸ" Ù‚Ø§Ù„ Ù„Ù„ÙØ£Ø±. ðŸ­ðŸ’­

          Ø§Ù„ÙØ£Ø± ÙÙ‡Ù… ÙˆØ£Ø®Ø° Ø§Ù„ÙˆØ±Ù‚Ø© Ø§Ù„ØªÙŠ ÙƒØªØ¨Ù‡Ø§ Ø§Ù„Ø¹Ø¬ÙˆØ². Ù‚Ø±Ø£Ù‡Ø§ Ø¨Ø¹Ù†Ø§ÙŠØ© ÙˆØ¨Ø¯Ø£ ÙÙŠ ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£ÙˆØ±Ø§Ù‚. ðŸ‘

          Ø¹Ù…Ù„ Ø§Ù„ÙØ£Ø± Ø¨Ø¬Ø¯ ÙˆØ§ØªÙ‚Ø§Ù†! ðŸ¤© ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©ØŒ Ø£ØµØ¨Ø­Øª Ø§Ù„ØºØ±ÙØ© Ù…Ù†Ø¸Ù…Ø© ÙˆØ¬Ù…ÙŠÙ„Ø©. ðŸ“šðŸ’¼

          Ø§Ù„Ø¹Ø¬ÙˆØ² Ø´Ø¹Ø± Ø¨Ø§Ù„Ø§Ù…ØªÙ†Ø§Ù† ÙˆØ§Ù„Ø¯Ù‡Ø´Ø©. Ø£Ø¯Ø±Ùƒ Ø£Ù† Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙŠÙ…ÙƒÙ† Ø£Ù† ØªØ£ØªÙŠ Ù…Ù† Ø£Ù…Ø§ÙƒÙ† ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹Ø©. ðŸ™â¤ï¸

          Ù…Ù†Ø° Ø°Ù„Ùƒ Ø§Ù„Ø­ÙŠÙ†ØŒ Ø£ØµØ¨Ø­ Ø§Ù„Ø¹Ø¬ÙˆØ² Ø£ÙƒØ«Ø± ØªØ³Ø§Ù…Ø­Ù‹Ø§ ÙˆØªÙ‚Ø¯ÙŠØ±Ù‹Ø§ Ù„Ù„Ø¢Ø®Ø±ÙŠÙ†. ØªØ±ÙƒØª Ù‚ØµØ© Ø§Ù„ÙØ£Ø± Ø£Ø«Ø±Ù‹Ø§ ÙÙŠ Ù‚Ù„Ø¨Ù‡. ðŸ’–âœ¨`,
        },
        {
          role: "user",
          content: `story for childrens and is about curiosity`,
        },
        {
          role: "assistant",
          content: `
          Ù‚ØµØ© Ø¹Ù† Ø§Ù„ÙØ¶ÙˆÙ„
          #
          Ø­Ù„Ù… Ø§Ù„ÙØ¶Ø§Ø¡
          #
          Ù‚ØµØ© Ø¹Ù† ÙØªØ§Ø© ØªÙØ¯Ø¹Ù‰ Ø²ÙŠÙ†Ø¨ ØªÙ…ØªÙ„Ùƒ ÙØ¶ÙˆÙ„Ù‹Ø§ Ù„Ø§ ÙŠØ´Ø¨Ù‡ Ø£ÙŠ Ø´ÙŠØ¡ Ø¢Ø®Ø± ÙˆØªØ³Ø¹Ù‰ Ù„Ø§ÙƒØªØ´Ø§Ù Ø£Ø³Ø±Ø§Ø± Ø§Ù„ÙØ¶Ø§Ø¡ Ø¨Ù…ÙØ±Ø¯Ù‡Ø§.
          #
          Ø­Ù„Ù…-Ø§Ù„ÙØ¶Ø§Ø¡
          #
          an illustration of a girl in a spacesuit, gazing at the stars
          #
          Ø²ÙŠÙ†Ø¨ ØªØ¹Ø´Ù‚ Ø§Ù„Ù…ØºØ§Ù…Ø±Ø§Øª ÙˆØ§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„ØªÙŠ ØªÙˆØ§Ø¬Ù‡Ù‡Ø§ ÙÙŠ Ø­ÙŠØ§ØªÙ‡Ø§ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©. ðŸŒŸ

          Ù„Ø¯ÙŠÙ‡Ø§ ÙØ¶ÙˆÙ„ Ø´Ø¯ÙŠØ¯ Ù„Ø§ ÙŠØ´Ø¨Ù‡ Ø£ÙŠ Ø´ÙŠØ¡ Ø¢Ø®Ø±. ÙƒØ§Ù†Øª ØªØ³Ø£Ù„ Ù†ÙØ³Ù‡Ø§ Ø¯Ø§Ø¦Ù…Ù‹Ø§: "Ù…Ø§Ø°Ø§ Ø³ÙŠØ­Ø¯Ø« Ø¥Ø°Ø§ Ø³Ø§ÙØ±Øª Ø¥Ù„Ù‰ Ø§Ù„ÙØ¶Ø§Ø¡ØŸ" ðŸš€

          Ø¨ÙŠÙ†Ù…Ø§ ÙƒØ§Ù†Øª ØªØ­Ø¨ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø¹Ù† Ø§Ù„ÙƒÙˆØ§ÙƒØ¨ ÙˆØ§Ù„Ù†Ø¬ÙˆÙ…ØŒ ÙƒØ§Ù† Ù„Ø¯ÙŠÙ‡Ø§ Ø±ØºØ¨Ø© Ø­Ù‚ÙŠÙ‚ÙŠØ© ÙÙŠ Ø±Ø¤ÙŠØªÙ‡Ø§ Ø¨Ù†ÙØ³Ù‡Ø§. ðŸ’«

          ØªØ§Ø±ÙƒØ© Ø®ÙŠØ§Ù„Ù‡Ø§ ÙŠØ³Ø§ÙØ± Ø¨Ø¹ÙŠØ¯Ù‹Ø§ØŒ Ù‚Ø±Ø±Øª Ø²ÙŠÙ†Ø¨ Ø§Ù„Ù‚ÙŠØ§Ù… Ø¨Ø§Ù„Ù…Ø³ØªØ­ÙŠÙ„. Ø­Ø²Ù…Øª Ø­Ù‚ÙŠØ¨Ø© ØµØºÙŠØ±Ø© ÙˆØ£Ø¹Ø¯Øª Ø§Ù„Ø³ÙØ± Ø¥Ù„Ù‰ Ø§Ù„ÙØ¶Ø§Ø¡! ðŸ§³âœ¨

          Ø¹Ù†Ø¯Ù…Ø§ ÙˆØµÙ„Øª Ø²ÙŠÙ†Ø¨ Ø¥Ù„Ù‰ Ø§Ù„ÙØ¶Ø§Ø¡ØŒ ÙˆØ¬Ø¯Øª Ù†ÙØ³Ù‡Ø§ Ù…Ø°Ù‡ÙˆÙ„Ø© Ù…Ù† Ø§Ù„Ø¬Ù…Ø§Ù„ ÙˆØ§Ù„Ø³ÙƒÙˆÙ† Ø§Ù„Ø°ÙŠ ÙŠØ­ÙŠØ· Ø¨Ù‡Ø§. ÙƒØ§Ù†Øª Ø§Ù„Ù†Ø¬ÙˆÙ… Ø£ÙƒØ«Ø± Ø¨Ø±ÙŠÙ‚Ù‹Ø§ ÙˆØ¬Ù…Ø§Ù„Ù‹Ø§ Ù…Ù…Ø§ ØªØµÙˆØ±Øª. ðŸŒ 

          Ø§Ø³ØªÙ…ØªØ¹Øª Ø²ÙŠÙ†Ø¨ Ø¨ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø¥Ø·Ù„Ø§Ù‚ ÙÙŠ Ø§Ù„ÙØ¶Ø§Ø¡ ÙˆØªÙ…ÙƒÙ†Øª Ù…Ù† Ø§Ù„Ø¹ÙˆÙ… ÙÙŠ Ø§Ù„ÙØ¶Ø§Ø¡ Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ. Ø´Ø¹Ø±Øª Ø¨Ø£Ù†Ù‡Ø§ Ø­Ø±Ø© Ù…Ø«Ù„ Ø§Ù„Ø·ÙŠÙˆØ± ÙÙŠ Ø§Ù„Ø³Ù…Ø§Ø¡. ðŸ¦

          Ø³Ø§ÙØ±Øª Ø²ÙŠÙ†Ø¨ Ù…Ù† ÙƒÙˆÙƒØ¨ Ø¥Ù„Ù‰ Ø¢Ø®Ø± ÙˆØ§Ø³ØªÙƒØ´ÙØª Ø§Ù„ÙƒÙˆØ§ÙƒØ¨ ÙˆØ£Ø´Ù…Ø§Ø³Ù‡Ø§ ÙˆØ£Ù‚Ù…Ø§Ø±Ù‡Ø§. Ù„Ù‚Ø¯ ÙƒØ§Ù†Øª Ø±Ø­Ù„Ø© Ø§Ø³ØªÙƒØ´Ø§Ù Ù…Ù…ØªØ¹Ø© ÙˆÙ…Ø°Ù‡Ù„Ø©! ðŸªðŸš€

          Ø¹Ù†Ø¯Ù…Ø§ Ø¹Ø§Ø¯Øª Ø²ÙŠÙ†Ø¨ Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø±Ø¶ØŒ Ø´Ø¹Ø±Øª Ø¨Ø£Ù†Ù‡Ø§ Ø£ÙƒØ«Ø± Ø¥Ù„Ù‡Ø§Ù…Ù‹Ø§ ÙˆØªÙØ§Ø¤Ù„Ø§. Ø£Ø¯Ø±ÙƒØª Ø£Ù† Ø§Ù„ÙØ¶ÙˆÙ„ ÙˆØ§Ù„Ø§Ø³ØªÙƒØ´Ø§Ù Ù‡Ù…Ø§ Ù…ÙØªØ§Ø­ Ù„Ù„ØªØ¹Ù„Ù… ÙˆØ§Ù„Ù†Ù…Ùˆ Ø§Ù„Ø´Ø®ØµÙŠ. ðŸŒðŸ”

          ØªØ°ÙƒØ±Øª Ø²ÙŠÙ†Ø¨ Ø¯Ø§Ø¦Ù…Ù‹Ø§ Ø£Ù† Ø§Ù„Ø¹Ø§Ù„Ù… ÙƒØ¨ÙŠØ± ÙˆÙ…Ù„ÙŠØ¡ Ø¨Ø§Ù„Ø£Ø´ÙŠØ§Ø¡ Ø§Ù„Ø¬Ù…ÙŠÙ„Ø© ÙˆØ§Ù„Ù…Ø¯Ù‡Ø´Ø©. ÙˆØ³Ø¹Øª Ø¨Ø·Ù…ÙˆØ­ Ù„Ù…ÙˆØ§ØµÙ„Ø© Ø§Ù„ÙƒØ´Ù Ø¹Ù† Ø§Ù„Ø£Ø³Ø±Ø§Ø± Ø§Ù„ØªÙŠ ÙŠØ®Ø¨Ø¦Ù‡Ø§ Ø§Ù„ÙØ¶Ø§Ø¡. âœ¨ðŸ”­`,
        },
        {
          role: "user",
          content: `story for childrens and is about self-confidence`,
        },
        {
          role: "assistant",
          content: `
          Ù‚ØµØ© Ø¹Ù† Ø§Ù„Ø«Ù‚Ø© Ø¨Ø§Ù„Ù†ÙØ³
          #
          Ø§Ù„ÙØ£Ø± Ø§Ù„Ø´Ø¬Ø§Ø¹
          #
          ÙØ£Ø± Ø´Ø¬Ø§Ø¹ ÙŠØ¬Ø¯ Ø§Ù„Ø«Ù‚Ø© ÙÙŠ Ù†ÙØ³Ù‡ ÙˆÙŠÙˆØ§Ø¬Ù‡ ØªØ­Ø¯ÙŠØ§ØªÙ‡ Ø¨Ø´Ø¬Ø§Ø¹Ø©
          #
          Ø§Ù„ÙØ£Ø±-Ø§Ù„Ø´Ø¬Ø§Ø¹
          #
          a small mouse standing on its hind legs with a determined expression
          #
          ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ ÙØ£Ø± ØµØºÙŠØ± ÙŠØ¯Ø¹Ù‰ Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ø·ÙŠÙ. ÙƒØ§Ù† Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ø·ÙŠÙ Ø®Ø¬ÙˆÙ„Ù‹Ø§ ÙˆØºÙŠØ± ÙˆØ§Ø«Ù‚ Ù…Ù† Ù†ÙØ³Ù‡. ðŸ­ðŸ˜”

          Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙˆØ§Ø¬Ù‡ Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ø·ÙŠÙ ØªØ­Ø¯ÙŠØ§Øª ØµØºÙŠØ±Ø©ØŒ ÙƒØ§Ù† ÙŠØ´Ø¹Ø± Ø¨Ø§Ù„Ø®ÙˆÙ ÙˆØ§Ù„Ù‚Ù„Ù‚. Ù„ÙƒÙ† ÙƒØ§Ù† Ù„Ø¯ÙŠÙ‡ Ø±ØºØ¨Ø© ÙÙŠ ØªØºÙŠÙŠØ± Ø°Ù„Ùƒ! ðŸ’ªðŸ’–

          Ù‚Ø±Ø± Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ø·ÙŠÙ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø«Ù‚Ø© ÙÙŠ Ù†ÙØ³Ù‡ ÙˆØ§Ù„ØªØºÙ„Ø¨ Ø¹Ù„Ù‰ Ø®ÙˆÙÙ‡. Ù‚Ø§Ù„ ÙÙŠ Ù†ÙØ³Ù‡: "Ø£Ù†Ø§ Ø´Ø¬Ø§Ø¹ØŒ ÙˆÙŠÙ…ÙƒÙ†Ù†ÙŠ ÙØ¹Ù„ Ø£ÙŠ Ø´ÙŠØ¡!" ðŸŒŸðŸ˜Š

          Ø£ÙˆÙ„ Ù…ØºØ§Ù…Ø±Ø© Ù„Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ø·ÙŠÙ ÙƒØ§Ù†Øª Ù…ÙˆØ§Ø¬Ù‡Ø© Ù‚Ø·Ø© ÙƒØ¨ÙŠØ±Ø© ÙˆÙ…Ø®ÙŠÙØ©. ØªØ±Ø¯Ø¯ Ù‚Ù„ÙŠÙ„Ø§Ù‹ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©ØŒ ÙˆÙ„ÙƒÙ†Ù‡ Ø§Ø³ØªØ®Ø¯Ù… Ø´Ø¬Ø§Ø¹ØªÙ‡ ÙˆÙˆØ§Ø¬Ù‡Ù‡Ø§ Ø¨Ø«Ù‚Ø©! ðŸˆðŸ’¥

          Ø¹Ù†Ø¯Ù…Ø§ Ø±Ø£Øª Ø§Ù„Ù‚Ø·Ø© Ø§Ù„Ø´Ø¬Ø§Ø¹Ø© ÙˆØ§Ù„Ø«Ù‚Ø© ÙÙŠ Ø¹ÙŠÙ†ÙŠ Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ø·ÙŠÙØŒ ÙØ±Øª Ø¨Ø¹ÙŠØ¯Ù‹Ø§. ÙƒØ§Ù†Øª ØªØ¹ØªØ±Ù Ø¨Ø£Ù† Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ø·ÙŠÙ Ø£ØµØ¨Ø­ ÙØ£Ø±Ù‹Ø§ Ø´Ø¬Ø§Ø¹Ù‹Ø§! ðŸ˜¼âœ¨

          Ù…Ø¹ Ù…Ø±ÙˆØ± Ø§Ù„ÙˆÙ‚ØªØŒ Ø£ØµØ¨Ø­ Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ø·ÙŠÙ Ø´Ø¬Ø§Ø¹Ù‹Ø§ Ø£ÙƒØ«Ø± ÙˆØ£ÙƒØ«Ø±. Ø£ØµØ¨Ø­ Ù‚Ø§Ø¯Ø±Ù‹Ø§ Ø¹Ù„Ù‰ Ù…ÙˆØ§Ø¬Ù‡Ø© ÙƒÙ„ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„ØªÙŠ ØªØ¹ØªØ±Ø¶ Ø·Ø±ÙŠÙ‚Ù‡. ðŸŒŸðŸ’ª

          ÙˆØ¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„Ø®ÙˆÙØŒ Ø£ØµØ¨Ø­ ÙŠØ´Ø¹Ø± Ø¨Ø«Ù‚Ø© ÙƒÙ„Ù…Ø§ ÙˆØ§Ø¬Ù‡ ØªØ­Ø¯ÙŠÙ‹Ø§ Ø¬Ø¯ÙŠØ¯Ù‹Ø§. Ø£Ø¯Ø±Ùƒ Ø£Ù†Ù‡ ÙŠÙ…ÙƒÙ†Ù‡ ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ù…Ø³ØªØ­ÙŠÙ„ Ø¥Ø°Ø§ ÙƒØ§Ù† ÙŠØ¤Ù…Ù† Ø¨Ù†ÙØ³Ù‡. ðŸ’–

          ÙØ£ØµØ¨Ø­Øª Ù‚ØµØ© Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ø·ÙŠÙ Ù‚ØµØ© Ø§Ù„Ø´Ø¬Ø§Ø¹Ø© ÙˆØ§Ù„Ø«Ù‚Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ¦Ø±Ø§Ù† Ø§Ù„ØµØºÙŠØ±Ø© ÙÙŠ Ø§Ù„ØºØ§Ø¨Ø©. ÙƒÙ„ Ù…Ù† ÙŠØ³Ù…Ø¹ Ù‚ØµØªÙ‡ØŒ ÙŠØ¯Ø±Ùƒ Ø£Ù†Ù‡ ÙŠÙ…ÙƒÙ†Ù‡Ù… Ø§Ù„ÙˆÙ‚ÙˆÙ Ø¨Ø«Ù‚Ø© ÙˆØ¬Ø±Ø£Ø© Ø£Ù…Ø§Ù… Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª! ðŸ“šðŸŒŸ`,
        },
        {
          role: "user",
          content: `story for childrens and is about cooperation`,
        },
        {
          role: "assistant",
          content: `
          Ù‚ØµØ© Ø¹Ù† Ø§Ù„ØªØ¹Ø§ÙˆÙ†
          #
          Ù…Ø­Ù…Ø¯ ÙˆØ§Ù„ØºØ§Ø¨Ø©
          #
          Ø´Ø§Ø¨ ÙŠÙƒØªØ´Ù Ø§Ù„Ù‚ÙˆØ© ÙÙŠ Ø§Ù„ØªØ¹Ø§ÙˆÙ† ÙˆØ§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ù…Ø¹ Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„ØºØ§Ø¨Ø©.
          #
          Ù…Ø­Ù…Ø¯-Ùˆ-Ø§Ù„ØºØ§Ø¨Ø©
          #
          a young man surrounded by wolves in a  forest
          #
          ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù…Ø±Ø© Ø´Ø§Ø¨ ÙŠØ¯Ø¹Ù‰ Ù…Ø­Ù…Ø¯ ðŸŒº. ÙƒØ§Ù† ÙŠØ¹ÙŠØ´ ÙÙŠ Ù‚Ø±ÙŠØ© ØµØºÙŠØ±Ø© Ù‚Ø±Ø¨ Ø§Ù„ØºØ§Ø¨Ø© Ø§Ù„Ø³Ø­Ø±ÙŠØ© ðŸŒ³. Ù…Ø­Ù…Ø¯ ÙƒØ§Ù† Ø´ØºÙˆÙ Ø¬Ø¯Ø§ Ø¨Ø§Ù„Ø·Ø¨ÙŠØ¹Ø© ÙˆØ§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª ðŸŒ¿ðŸ¦‹.

          ÙÙŠ ÙŠÙˆÙ… Ù…Ù† Ø§Ù„Ø£ÙŠØ§Ù…ØŒ Ù‚Ø±Ø± Ù…Ø­Ù…Ø¯ Ø§Ø³ØªÙƒØ´Ø§Ù Ø§Ù„ØºØ§Ø¨Ø© Ø§Ù„Ø³Ø­Ø±ÙŠØ© ðŸŒ². ÙƒØ§Ù†Øª Ø§Ù„ØºØ§Ø¨Ø© Ù…Ù„ÙŠØ¦Ø© Ø¨Ø§Ù„Ù…Ø®Ù„ÙˆÙ‚Ø§Øª Ø§Ù„Ø³Ø­Ø±ÙŠØ© ÙˆØ§Ù„Ø£Ø´Ø¬Ø§Ø± Ø§Ù„Ø¶Ø®Ù…Ø©. ÙƒØ§Ù†  Ø®Ø§Ø¦Ù Ù‚Ù„ÙŠÙ„Ø§ ÙˆÙ„ÙƒÙ†Ù‡ ÙƒØ§Ù† Ø´Ø¬Ø§Ø¹Ø§ ðŸ’ª.

          Ø£Ø«Ù†Ø§Ø¡ ØªØ¬ÙˆØ§Ù„Ù‡ ÙÙŠ Ø§Ù„ØºØ§Ø¨Ø©ØŒ ØµØ§Ø¯Ù Ù…Ø­Ù…Ø¯ Ø°Ø¦Ø¨Ù‹Ø§ ÙŠØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ù…Ø³Ø§Ø¹Ø¯Ù‡. Ø§Ù„Ø°Ø¦Ø¨ ÙŠØ¹Ø§Ù†ÙŠ Ù…Ù† Ø¥ØµØ§Ø¨Ø© ÙÙŠ Ù‚Ø¯Ù…Ù‡ ÙˆÙ„Ø§ ÙŠØ³ØªØ·ÙŠØ¹ Ø§Ù„ØªØ­Ø±Ùƒ. ØªÙˆØ¬Ù‡ Ù…Ø­Ù…Ø¯ Ø¨Ø³Ø±Ø¹Ø© Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙ‡ ðŸºâœ¨.

          Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ù‡Ø§Ø±Ø§ØªÙ‡ ÙˆÙ…Ø¹Ø±ÙØªÙ‡ Ù‚Ø§Ù… Ù…Ø­Ù…Ø¯ Ø¨Ø¹Ù„Ø§Ø¬ Ø¬Ø±Ø­ Ø§Ù„Ø°Ø¦Ø¨ ÙˆÙ…Ø³Ø§Ø¹Ø¯ØªÙ‡ Ø¹Ù„Ù‰ Ø§Ù„ÙˆÙ‚ÙˆÙ Ø¹Ù„Ù‰ Ù‚Ø¯Ù…ÙŠÙ‡ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰. Ø´ÙƒØ± Ø§Ù„Ø°Ø¦Ø¨ Ù…Ø­Ù…Ø¯ Ø¹Ù„Ù‰ Ù…Ø³Ø§Ø¹Ø¯ØªÙ‡ ÙˆØ¹Ø±Ø¶ Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…  Ù„ÙŠÙƒÙˆÙ† ØµØ¯ÙŠÙ‚Ù‡ ðŸºâ¤ï¸.

          Ù…Ø­Ù…Ø¯ ÙˆØ§Ù„Ø°Ø¦Ø¨ Ø³Ø§Ø±ÙˆØ§ Ø³ÙˆÙŠÙ‹Ø§ ÙÙŠ Ø§Ù„ØºØ§Ø¨Ø©ØŒ ÙˆØ£Ø«Ù†Ø§Ø¡ Ø±Ø­Ù„ØªÙ‡Ù… ÙˆØ¬Ø¯ÙˆØ§  ØºØ²Ø§Ù„ ØµØºÙŠØ± ÙŠØ­ØªØ§Ø¬ Ø¥Ù„ÙŠÙ‡Ù…. ÙƒØ§Ù† Ø§Ù„ØºØ²Ø§Ù„ Ø¹Ø§Ù„Ù‚Ù‹Ø§ ÙÙŠ Ø´Ø¬Ø±Ø© Ø¹Ø§Ù„ÙŠØ© ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ù„Ù†Ø²ÙˆÙ„ ðŸ”ðŸ¦Œ.

          Ø¨Ø±ØºÙ… Ø§Ù„ØªØ­Ø¯ÙŠØŒ Ù‚Ø±Ø± Ù…Ø­Ù…Ø¯ ÙˆØ§Ù„Ø°Ø¦Ø¨ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„ØºØ²Ø§Ù„. ØªØ¹Ø§ÙˆÙ†ÙˆØ§ Ù…Ø¹Ù‹Ø§: ØµØ¹Ø¯ Ù…Ù…Ø­Ø¯ Ø§Ù„Ø´Ø¬Ø±Ø© ÙˆØ£Ù…Ø³Ùƒ Ø¨Ø§Ù„ØºØ²Ø§Ù„ ÙˆØ³Ø§Ø¹Ø¯Ù‡ Ø§Ù„Ø°Ø¦Ø¨ ØŒ ÙˆÙ†Ø¬Ø­ÙˆØ§ ÙÙŠ Ø¥Ù†Ø²Ø§Ù„ Ø§Ù„ØºØ²Ø§Ù„ Ø¨Ø³Ù„Ø§Ù… ÙˆØ³Ø· ÙØ±Ø­Ø© Ø¹Ø§Ø±Ù…Ø© ðŸŒŸðŸŒ³â¤ï¸.

          ÙˆÙ…Ù†Ø° Ø°Ù„Ùƒ Ø§Ù„Ø­ÙŠÙ†ØŒ Ø£ØµØ¨Ø­ÙˆØ§ Ø£ØµØ¯Ù‚Ø§Ø¡ Ù…Ù‚Ø±Ø¨ÙŠÙ†. ÙŠØ¹ÙŠØ´ÙˆÙ† Ø³ÙˆÙŠÙ‹Ø§ ÙÙŠ Ø§Ù„ØºØ§Ø¨Ø© ÙˆÙŠØªØ¹Ø§ÙˆÙ†ÙˆÙ† Ù…Ø¹Ù‹Ø§ Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª Ø§Ù„Ø£Ø®Ø±Ù‰ ÙˆØ­Ù…Ø§ÙŠØ© Ø§Ù„Ø·Ø¨ÙŠØ¹Ø©. Ø£Ø¯Ø±Ùƒ Ù…Ø­Ù…Ø¯ Ø£Ù† Ø§Ù„ØªØ¹Ø§ÙˆÙ† Ù‚ÙˆØ© Ø­Ù‚ÙŠÙ‚ÙŠØ© ÙˆØ£Ù†Ù‡ ÙŠÙ…ÙƒÙ†Ù‡ ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„ÙƒØ«ÙŠØ± Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¢Ø®Ø±ÙŠÙ† ðŸ¤ðŸ’–ðŸŒ¿.`,
        },
        {
          role: "user",
          content: `story for childrens and is about Hard Work`,
        },
        {
          role: "assistant",
          content: `
          Ù‚ØµØ© Ø¹Ù† Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø¬Ø§Ø¯
          #
          Ø¹Ù…Ø§Ø± ÙˆÙ„Ø¹Ø¨Ø© Ø§Ù„Ø·Ø§Ø¦Ø±Ø©
          #
          ÙØªÙ‰ ÙŠØªØ¹Ù„Ù… Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø¬Ø§Ø¯ Ù…Ù† Ø®Ù„Ø§Ù„ Ù…Ù…Ø§Ø±Ø³Ø© Ø±ÙŠØ§Ø¶Ø© Ø§Ù„Ø·Ø§Ø¦Ø±Ø© ÙˆØ¨Ø°Ù„ Ø§Ù„Ø¬Ù‡Ø¯ Ù„ØªØ­Ù‚ÙŠÙ‚ Ø£Ø­Ù„Ø§Ù…Ù‡.
          #
          Ø¹Ù…Ø§Ø±-Ùˆ-Ù„Ø¹Ø¨Ø©-Ø§Ù„Ø·Ø§Ø¦Ø±Ø©
          #
          a boy practicing volleyball with determination in a gym
          #
          ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ ØµØ¨ÙŠ ÙŠØ¯Ø¹Ù‰ Ø¹Ù…Ø§Ø±. ÙƒØ§Ù† ÙŠØ­Ø¨ Ù„Ø¹Ø¨ ÙƒØ±Ø© Ø§Ù„Ø·Ø§Ø¦Ø±Ø© Ù…Ù†Ø° Ø§Ù„ØµØºØ±. ÙƒØ§Ù† ÙŠØ´Ø§Ù‡Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ø§Ù„Ù…Ø­ØªØ±ÙÙŠÙ† ÙˆÙŠØ­Ù„Ù… Ø¨Ø£Ù† ÙŠØµØ¨Ø­ Ù…Ø«Ù„Ù‡Ù… ÙŠÙˆÙ…Ø§Ù‹ Ù…Ø§. ðŸðŸ’ª
          
          Ù„ÙƒÙ† Ø¹Ù…Ø§Ø± Ø¹Ø±Ù Ø£Ù†Ù‡ Ù„Ù† ÙŠØªØ­Ù‚Ù‚ Ø­Ù„Ù…Ù‡ Ø¨Ø³Ù‡ÙˆÙ„Ø©. Ø¹Ù„ÙŠÙ‡ Ø£Ù† ÙŠØ¹Ù…Ù„ Ø¨Ø¬Ø¯ ÙˆÙŠÙ…Ø§Ø±Ø³ Ø¨Ø§Ù†ØªØ¸Ø§Ù… Ù„ÙŠØªØ·ÙˆØ± ÙˆÙŠØµØ¨Ø­ Ù„Ø§Ø¹Ø¨Ù‹Ø§ Ø¬ÙŠØ¯Ù‹Ø§. ðŸ‹ï¸â€â™‚ï¸ðŸ¤¸â€â™‚ï¸

          Ø§Ø³ØªÙŠÙ‚Ø¸ Ø¹Ù…Ø§Ø± ÙÙŠ Ø§Ù„ØµØ¨Ø§Ø­ Ø§Ù„Ø¨Ø§ÙƒØ± ÙˆØ°Ù‡Ø¨ Ø¥Ù„Ù‰ Ø§Ù„ØµØ§Ù„Ø© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ©. Ø¨Ø¯Ø£ Ø¨ØªØ¯Ø±ÙŠØ¨Ø§ØªÙ‡ Ø§Ù„ÙŠÙˆÙ…ÙŠØ©ØŒ ÙŠÙ…Ø§Ø±Ø³ Ø§Ù„Ø¶Ø±Ø¨Ø§Øª ÙˆØ§Ù„ØªÙ…Ø±ÙŠØ±Ø§Øª ÙˆÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ ØªØ­Ø³ÙŠÙ† Ù…Ù‡Ø§Ø±Ø§ØªÙ‡. ðŸ’¦ðŸ

          Ù„ÙƒÙ† Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ø·Ø±ÙŠÙ‚ Ø³Ù‡Ù„Ø§Ù‹. ÙƒØ§Ù†Øª Ù‡Ù†Ø§Ùƒ Ù„Ø­Ø¸Ø§Øª Ù…Ù† Ø§Ù„Ø¥Ø±Ù‡Ø§Ù‚ ÙˆØ§Ù„Ø¥Ø­Ø¨Ø§Ø·ØŒ ÙˆÙ„ÙƒÙ† Ø¹Ù…Ø§Ø± ÙˆØ§ØµÙ„ Ø§Ù„Ø¹Ù…Ù„ Ø¨Ø¬Ø¯ ÙˆØªØ­Ù…Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª. Ø±Ø£Ù‰ Ø§Ù„Ø¬Ù‡Ø¯ Ø§Ù„Ù…Ø³ØªÙ…Ø± Ù†ØªØ§Ø¦Ø¬Ù‡ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ©. ðŸ‘âœ¨

          Ø¨Ù…Ø±ÙˆØ± Ø§Ù„ÙˆÙ‚ØªØŒ Ø£ØµØ¨Ø­ Ø£Ø­Ù…Ø¯ Ù„Ø§Ø¹Ø¨Ù‹Ø§ Ù…Ù…ÙŠØ²Ù‹Ø§ ÙˆÙ‚ÙˆÙŠÙ‹Ø§. Ù‚Ø§Ø¯ ÙØ±ÙŠÙ‚Ù‡ Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ø§Ù†ØªØµØ§Ø±Ø§Øª ÙˆØ­ØµØ¯ Ø§Ù„ÙƒØ«ÙŠØ± Ù…Ù† Ø§Ù„Ø¬ÙˆØ§Ø¦Ø². ÙƒØ§Ù†Øª Ø§Ù„Ù„Ø¹Ø¨Ø© ØªØ¹Ù„Ù…Ù‡ Ø§Ù„ØµØ¨Ø± ÙˆØ§Ù„ØªØ­Ù…Ù„ ÙˆØ£Ù‡Ù…ÙŠØ© Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø¬Ø§Ø¯. ðŸŒŸðŸ¤

          ØµØ§Ø±Ø­ Ø¹Ù…Ø§Ø± Ø§Ù„Ø¢Ø®Ø±ÙŠÙ† Ø¨Ø£Ù† Ø§Ù„Ù†Ø¬Ø§Ø­ Ù„Ø§ ÙŠØ£ØªÙŠ Ø¨Ø§Ù„ØµØ¯ÙØ©ØŒ Ø¨Ù„ ÙŠØ£ØªÙŠ Ù…Ù† Ø®Ù„Ø§Ù„ ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù ÙˆØ§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø¬Ø§Ø¯. Ø¨Ø¯Ø£ ÙŠÙ„Ù‡Ù… Ø§Ù„Ø¢Ø®Ø±ÙŠÙ† Ù„Ù„Ø¹Ù…Ù„ Ø¨Ø¬Ø¯ ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ø£Ø­Ù„Ø§Ù…Ù‡Ù…. ðŸ’–ðŸ’ª

          ÙˆØ¨Ù‡Ø°Ù‡ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©ØŒ Ø£Ø«Ø±Øª Ù‚ØµØ© Ø¹Ù…Ø§Ø± Ø¹Ù„Ù‰ Ø­ÙŠØ§Ø© Ø§Ù„Ø¹Ø¯ÙŠØ¯ Ù…Ù† Ø§Ù„Ø£Ø´Ø®Ø§ØµØŒ Ø­ÙŠØ« ØªØ°ÙƒØ±ÙˆØ§ Ø¯Ø§Ø¦Ù…Ù‹Ø§ Ø£Ù‡Ù…ÙŠØ© Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø¬Ø§Ø¯ ÙˆØ§Ù„Ø§Ø¬ØªÙ‡Ø§Ø¯ ÙÙŠ ØªØ­Ù‚ÙŠÙ‚ Ø£Ø­Ù„Ø§Ù…Ù‡Ù…. ðŸŒŸðŸ’¼

          Ø¹Ù…Ø§Ø± Ø£Ø¯Ø±Ùƒ Ø£Ù† Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø¬Ø§Ø¯ Ù‡Ùˆ Ø§Ù„Ù…ÙØªØ§Ø­ Ù„Ù„Ù†Ø¬Ø§Ø­ ÙˆØ§Ù„ØªØ­Ù‚ÙŠÙ‚. ÙˆØ¨ÙØ¶Ù„ Ø§Ù„Ø¹Ø²ÙŠÙ…Ø© ÙˆØ§Ù„Ø¬Ù‡ÙˆØ¯ Ø§Ù„Ø·ÙˆÙŠÙ„Ø©ØŒ ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª ÙˆØªØ­Ù‚ÙŠÙ‚ Ø£Ø­Ù„Ø§Ù…Ùƒ Ø£ÙŠØ¶Ù‹Ø§.ðŸ’ª`,
        },
        {
          role: "user",
          content: `story for childrens and is about ${category}`,
        },
      ],
    }),
  });

  const stream = new ReadableStream({
    async start(controller) {
      function onParse(event: ParsedEvent | ReconnectInterval) {
        if (event.type === "event") {
          const data = event.data;
          if (data === "[DONE]") {
            controller.close();
            return;
          }
          try {
            const json = JSON.parse(data);

            const message = json.choices[0].delta.content;
            if (counter < 2 && (message?.match(/\n/) || []).length) {
              return;
            }
            const queue = encoder.encode(message);
            controller.enqueue(queue);
            counter++;
          } catch (e) {
            controller.error(e);
          }
        }
      }

      // stream response (SSE) from OpenAI may be fragmented into multiple chunks
      // this ensures we properly read chunks & invoke an event for each SSE event stream
      const parser = createParser(onParse);

      // https://web.dev/streams/#asynchronous-iteration
      for await (const chunk of response.body as any) {
        parser.feed(decoder.decode(chunk));
      }
    },
  });

  return cors(req, new Response(stream), {
    origin: process.env.NEXTAUTH_URL,
    methods: ["POST"],
  });
}
